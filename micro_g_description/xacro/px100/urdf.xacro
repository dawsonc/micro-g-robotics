<?xml version="1.0"?>
<robot xmlns:xacro="http://ros.org/wiki/xacro">
  <xacro:macro name="px100_urdf" params="prefix parent use_sim *origin">

    <!-- Interbotix magic numbers -->
    <xacro:property name="pi_offset" value="0.00001" />

    <!-- Materials -->
    <material name="interbotix_black">
      <color rgba="0.1 0.1 0.1 1" />
    </material>

    <!-- Links -->
    <link name="${prefix}base_link">
      <visual>
        <origin rpy="0 0 ${pi/2}" xyz="0 0 0" />
        <geometry>
          <mesh
            filename="$(find interbotix_xsarm_descriptions)/meshes/px100_meshes/base.stl"
            scale="0.001 0.001 0.001"
          />
        </geometry>
        <material name="interbotix_black" />
      </visual>
      <collision>
        <origin rpy="0 0 ${pi/2}" xyz="0 0 0" />
        <geometry>
          <mesh
            filename="$(find interbotix_xsarm_descriptions)/meshes/px100_meshes/base.stl"
            scale="0.001 0.001 0.001"
          />
        </geometry>
      </collision>
      <inertial>
        <origin rpy="0 0 ${pi/2}" xyz="-0.0332053000 0.0008915770 0.0211913000" />
        <mass value="0.395887" />
        <inertia
          ixx="0.0010650000"
          iyy="0.0003332000"
          izz="0.0012080000"
          ixy="-0.0000130300"
          ixz="0.0000018614"
          iyz="0.0000409200"
        />
      </inertial>
    </link>

    <link name="${prefix}shoulder_link">
      <visual>
        <origin rpy="0 0 ${pi/2}" xyz="0 0 -0.0022" />
        <geometry>
          <mesh
            filename="$(find interbotix_xsarm_descriptions)/meshes/px100_meshes/shoulder.stl"
            scale="0.001 0.001 0.001" />
        </geometry>
        <material name="interbotix_black" />
      </visual>
      <collision>
        <origin rpy="0 0 ${pi/2}" xyz="0 0 -0.0022" />
        <geometry>
          <mesh
            filename="$(find interbotix_xsarm_descriptions)/meshes/px100_meshes/shoulder.stl"
            scale="0.001 0.001 0.001"
          />
        </geometry>
      </collision>
      <inertial>
        <origin rpy="0 0 ${pi/2}" xyz="0.0000111169 -0.0003605640 0.0284598000" />
        <mass value="0.072587" />
        <inertia
          ixx="0.0000231000"
          iyy="0.0000253500"
          izz="0.0000144200"
          ixy="0.0000000003"
          ixz="0.0000001606"
          iyz="-0.0000000206"
        />
      </inertial>
    </link>

    <link name="${prefix}upper_arm_link">
      <visual>
        <origin rpy="0 0 ${pi/2}" xyz="0 0 0" />
        <geometry>
          <mesh
            filename="$(find interbotix_xsarm_descriptions)/meshes/px100_meshes/upper_arm.stl"
            scale="0.001 0.001 0.001"
          />
        </geometry>
        <material name="interbotix_black" />
      </visual>
      <collision>
        <origin rpy="0 0 ${pi/2}" xyz="0 0 0" />
        <geometry>
          <mesh
            filename="$(find interbotix_xsarm_descriptions)/meshes/px100_meshes/upper_arm.stl"
            scale="0.001 0.001 0.001"
          />
        </geometry>
      </collision>
      <inertial>
        <origin rpy="0 0 ${pi/2}" xyz="0.0161976963 -0.0002929352 0.0877230000" />
        <mass value="0.082923" />
        <inertia
          ixx="0.0000800600"
          iyy="0.0000745900"
          izz="0.0000368500"
          ixy="-0.0000002144"
          ixz="0.0000002982"
          iyz="0.0000165700"
        />
      </inertial>
    </link>

    <link name="${prefix}forearm_link">
      <visual>
        <origin rpy="0 0 ${pi/2}" xyz="0 0 0" />
        <geometry>
          <mesh
            filename="$(find interbotix_xsarm_descriptions)/meshes/px100_meshes/forearm.stl"
            scale="0.001 0.001 0.001"
          />
        </geometry>
        <material name="interbotix_black" />
      </visual>
      <collision>
        <origin rpy="0 0 ${pi/2}" xyz="0 0 0" />
        <geometry>
          <mesh
            filename="$(find interbotix_xsarm_descriptions)/meshes/px100_meshes/forearm.stl"
            scale="0.001 0.001 0.001"
          />
        </geometry>
      </collision>
      <inertial>
        <origin rpy="0 0 ${pi/2}" xyz="0.0773720000 -0.0003324882 0.0000000000" />
        <mass value="0.073058" />
        <inertia
          ixx="0.0000533800"
          iyy="0.0000165300"
          izz="0.0000603500"
          ixy="-0.0000003073"
          ixz="0.0000000000"
          iyz="0.0000000000"
        />
      </inertial>
    </link>

    <link name="${prefix}gripper_link">
      <visual>
        <origin rpy="0 0 ${pi/2}" xyz="0 0 0" />
        <geometry>
          <mesh
            filename="$(find interbotix_xsarm_descriptions)/meshes/px100_meshes/gripper.stl"
            scale="0.001 0.001 0.001"
          />
        </geometry>
        <material name="interbotix_black" />
      </visual>
      <collision>
        <origin rpy="0 0 ${pi/2}" xyz="0 0 0" />
        <geometry>
          <mesh
            filename="$(find interbotix_xsarm_descriptions)/meshes/px100_meshes/gripper.stl"
            scale="0.001 0.001 0.001"
          />
        </geometry>
      </collision>
      <inertial>
        <origin rpy="0 0 ${pi/2}" xyz="0.0446910000 0.0000000000 0.0113540000" />
        <mass value="0.069929" />
        <inertia
          ixx="0.0000226800"
          iyy="0.0000204400"
          izz="0.0000197400"
          ixy="0.0000000000"
          ixz="0.0000000000"
          iyz="0.0000008485"
        />
      </inertial>
    </link>

    <link name="${prefix}ee_arm_link">
      <inertial>
        <mass value="0.001" />
        <inertia
          ixx="0.001"
          iyy="0.001"
          izz="0.001"
          ixy="0" ixz="0"
          iyz="0"
        />
      </inertial>
    </link>

    <link name="${prefix}gripper_prop_link">
      <visual>
        <origin rpy="0 0 ${pi/2}" xyz="-0.0685 0 0" />
        <geometry>
          <mesh
            filename="$(find interbotix_xsarm_descriptions)/meshes/px100_meshes/gripper_prop.stl"
            scale="0.001 0.001 0.001" />
        </geometry>
        <material name="interbotix_black" />
      </visual>
      <collision>
        <origin rpy="0 0 ${pi/2}" xyz="-0.0685 0 0" />
        <geometry>
          <mesh
            filename="$(find interbotix_xsarm_descriptions)/meshes/px100_meshes/gripper_prop.stl"
            scale="0.001 0.001 0.001"
          />
        </geometry>
      </collision>
      <inertial>
        <origin rpy="0 0 ${pi/2}" xyz="0.0008460000 -0.0000019330 0.0000420000" />
        <mass value="0.00434" />
        <inertia
          ixx="0.0000005923"
          iyy="0.0000011156"
          izz="0.0000005743"
          ixy="0.0000000000"
          ixz="0.0000003195"
          iyz="-0.0000000004"
        />
      </inertial>
    </link>

    <link name="${prefix}gripper_bar_link">
      <visual>
        <origin rpy="0 0 ${pi/2}" xyz="-0.063 0 0" />
        <geometry>
          <mesh
            filename="$(find interbotix_xsarm_descriptions)/meshes/px100_meshes/gripper_bar.stl"
            scale="0.001 0.001 0.001"
          />
        </geometry>
        <material name="interbotix_black" />
      </visual>
      <collision>
        <origin rpy="0 0 ${pi/2}" xyz="-0.063 0 0" />
        <geometry>
          <mesh
            filename="$(find interbotix_xsarm_descriptions)/meshes/px100_meshes/gripper_bar.stl"
            scale="0.001 0.001 0.001"
          />
        </geometry>
      </collision>
      <inertial>
        <origin rpy="0 0 ${pi/2}" xyz="0.0096870000 0.0000005660 0.0049620000" />
        <mass value="0.034199" />
        <inertia
          ixx="0.0000074125"
          iyy="0.0000284300"
          izz="0.0000286000"
          ixy="-0.0000000008"
          ixz="-0.0000000006"
          iyz="-0.0000013889"
        />
      </inertial>
    </link>

    <link name="${prefix}fingers_link">
      <inertial>
        <mass value="0.001" />
        <inertia
          ixx="0.001"
          iyy="0.001"
          izz="0.001"
          ixy="0"
          ixz="0"
          iyz="0"
        />
      </inertial>
    </link>

    <link name="${prefix}left_finger_link">
      <visual>
        <origin rpy="${pi} ${pi} 0" xyz="0 0.005 0" />
        <geometry>
          <mesh
            filename="$(find interbotix_xsarm_descriptions)/meshes/px100_meshes/gripper_finger.stl"
            scale="0.001 0.001 0.001" />
        </geometry>
        <material name="interbotix_black" />
      </visual>
      <collision>
        <origin rpy="${pi} ${pi} 0" xyz="0 0.005 0" />
        <geometry>
          <mesh
            filename="$(find interbotix_xsarm_descriptions)/meshes/px100_meshes/gripper_finger.stl"
            scale="0.001 0.001 0.001"
          />
        </geometry>
      </collision>
      <inertial>
        <origin rpy="${pi} ${pi} ${pi/2}" xyz="0.0138160000 0.0000000000 0.0000000000" />
        <mass value="0.016246" />
        <inertia
          ixx="0.0000047310"
          iyy="0.0000015506"
          izz="0.0000037467"
          ixy="-0.0000004560"
          ixz="0.0000000000"
          iyz="0.0000000000"
        />
      </inertial>
    </link>

    <link name="${prefix}right_finger_link">
      <visual>
        <origin rpy="0 ${pi} 0" xyz="0 -0.005 0" />
        <geometry>
          <mesh
            filename="$(find interbotix_xsarm_descriptions)/meshes/px100_meshes/gripper_finger.stl"
            scale="0.001 0.001 0.001"
          />
        </geometry>
        <material name="interbotix_black" />
      </visual>
      <collision>
        <origin rpy="0 ${pi} 0" xyz="0 -0.005 0" />
        <geometry>
          <mesh
            filename="$(find interbotix_xsarm_descriptions)/meshes/px100_meshes/gripper_finger.stl"
            scale="0.001 0.001 0.001"
          />
        </geometry>
      </collision>
      <inertial>
        <origin rpy="0 ${pi} ${pi/2}" xyz="0.0138160000 0.0000000000  0.0000000000" />
        <mass value="0.016246" />
        <inertia
          ixx="0.0000047310"
          iyy="0.0000015506"
          izz="0.0000037467"
          ixy="0.0000004560"
          ixz="0.0000000000"
          iyz="0.0000000000"
        />
      </inertial>
    </link>

    <joint name="ee_gripper" type="fixed">
      <axis xyz="1 0 0" />
      <origin rpy="0 0 0" xyz="0.027575 0 0" />
      <parent link="${prefix}fingers_link" />
      <child link="${prefix}ee_gripper_link" />
    </joint>

    <link name="${prefix}ee_gripper_link">
      <inertial>
        <mass value="0.001" />
        <inertia
          ixx="0.001"
          iyy="0.001"
          izz="0.001"
          ixy="0"
          ixz="0"
          iyz="0"
        />
      </inertial>
    </link>

    <!-- Joints -->
    <joint name="${prefix}base_joint" type="fixed">
      <xacro:insert_block name="origin" />
      <parent link="${parent}" />
      <child link="${prefix}base_link" />
    </joint>

    <joint name="${prefix}waist" type="revolute">
      <axis xyz="0 0 1" />
      <limit effort="1" lower="${-pi + pi_offset}" upper="${pi - pi_offset}" velocity="${pi}" />
      <origin rpy="0 0 0" xyz="0 0 0.05085" />
      <parent link="${prefix}base_link" />
      <child link="${prefix}shoulder_link" />
      <dynamics friction="0.1" />
    </joint>

    <joint name="${prefix}shoulder" type="revolute">
      <axis xyz="0 1 0" />
      <limit effort="2" lower="${radians(-111)}" upper="${radians(107)}" velocity="${pi}" />
      <origin rpy="0 0 0" xyz="0 0 0.04225" />
      <parent link="${prefix}shoulder_link" />
      <child link="${prefix}upper_arm_link" />
      <dynamics friction="0.1" />
    </joint>

    <joint name="${prefix}elbow" type="revolute">
      <axis xyz="0 1 0" />
      <limit effort="2" lower="${radians(-121)}" upper="${radians(92)}" velocity="${pi}" />
      <origin rpy="0 0 0" xyz="0.035 0 0.1" />
      <parent link="${prefix}upper_arm_link" />
      <child link="${prefix}forearm_link" />
      <dynamics friction="0.1" />
    </joint>

    <joint name="${prefix}wrist_angle" type="revolute">
      <axis xyz="0 1 0" />
      <limit effort="1" lower="${radians(-100)}" upper="${radians(123)}" velocity="${pi}" />
      <origin rpy="0 0 0" xyz="0.1 0 0" />
      <parent link="${prefix}forearm_link" />
      <child link="${prefix}gripper_link" />
      <dynamics friction="0.1" />
    </joint>

    <joint name="${prefix}ee_arm" type="fixed">
      <axis xyz="1 0 0" />
      <origin rpy="0 0 0" xyz="0.063 0 0" />
      <parent link="${prefix}gripper_link" />
      <child link="${prefix}ee_arm_link" />
    </joint>

    <joint name="${prefix}gripper" type="continuous">
      <axis xyz="1 0 0" />
      <limit effort="1" velocity="${pi}" />
      <origin rpy="0 0 0" xyz="0.0055 0 0" />
      <parent link="${prefix}ee_arm_link" />
      <child link="${prefix}gripper_prop_link" />
      <dynamics friction="0.1" />
    </joint>

    <joint name="${prefix}gripper_bar" type="fixed">
      <axis xyz="1 0 0" />
      <origin rpy="0 0 0" xyz="0 0 0" />
      <parent link="${prefix}ee_arm_link" />
      <child link="${prefix}gripper_bar_link" />
    </joint>

    <joint name="${prefix}ee_bar" type="fixed">
      <axis xyz="1 0 0" />
      <origin rpy="0 0 0" xyz="0.023 0 0" />
      <parent link="${prefix}gripper_bar_link" />
      <child link="${prefix}fingers_link" />
    </joint>

    <joint name="${prefix}left_finger" type="prismatic">
      <axis xyz="0 1 0" />
      <limit effort="5" lower="0.015" upper="0.037" velocity="1" />
      <origin rpy="0 0 0" xyz="0 0 0" />
      <parent link="${prefix}fingers_link" />
      <child link="${prefix}left_finger_link" />
      <dynamics friction="0.1" />
    </joint>

    <joint name="${prefix}right_finger" type="prismatic">
      <axis xyz="0 1 0" />
      <limit effort="5" lower="-0.037" upper="-0.015" velocity="1" />
      <origin rpy="0 0 0" xyz="0 0 0" />
      <parent link="${prefix}fingers_link" />
      <child link="${prefix}right_finger_link" />
      <dynamics friction="0.1" />
      <xacro:unless value="${use_sim}">
        <mimic joint="${prefix}left_finger" multiplier="-1" offset="0" />
      </xacro:unless>
    </joint>

  </xacro:macro>

</robot>
